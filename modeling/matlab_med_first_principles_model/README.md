# MED First‑Principles Model

This folder contains a steady‑state, first‑principles model of a multi‑effect distillation (MED) plant, such as the one installed at the Plataforma Solar de Almería (PSA). The model describes in detail the thermal and mass transfer processes in the plant and can be used in two modes depending on the application: **calibration mode** and **simulation mode**.

At a high level, the MED process is represented as a sequence of **effects** (evaporators) and **preheaters**. In each effect, seawater partially evaporates under decreasing pressure and temperature, while in the preheaters the feedwater is gradually warmed using the condensation heat from the vapor produced in the effects. The model enforces mass and energy balances across all these components and tracks the different heat transfer mechanisms.

The model relies on the following simplifying assumptions:

- Steady‑state operation.
- Negligible heat losses to the environment.
- Isothermal physical properties in each control volume.

It is based on several works from the literature:

- El-Dessouky, Hisham, Imad Alatiqi, S. Bingulac, and Hisham Ettouney. “Steady-State Analysis of the Multiple Effect Evaporation Desalination Process.” Chemical Engineering & Technology 21, no. 5 (1998): 437–51.
- Mistry, Karan   H., Mohamed   A. Antar, and John   H. Lienhard V. “An Improved Model for Multiple Effect Distillation.” Desalination and Water Treatment 51, nos. 4–6 (2013): 807–21. DOI: [10.1080/19443994.2012.703383](https://doi.org/10.1080/19443994.2012.703383).
- Palenzuela, Patricia, Ashraf Hassan, Guillermo Zaragoza, and Diego-César Alarcón-Padilla. “Steady State Model for Multi-Effect Distillation Case Study: Plataforma Solar de Almería MED Pilot Plant.” Desalination 337 (March 2014): 31–42. DOI: [10.1016/j.desal.2013.12.029](https://doi.org/10.1016/j.desal.2013.12.029).

And extends them by:

- Including more detailed calculations for different heat transfer modes (boiling, flashing).
- Considering non‑constant non‑equilibrium allowance (NEA) and boiling point elevation (BPE).
- Accounting explicitly for the flashing of the distillate.

The model can be evaluated at both nominal and partial load conditions.

To solve the plant, the computation proceeds **cell by cell**, starting from the first effect and preheater and moving downstream. For each cell, a nonlinear system of equations is solved to enforce consistent heat exchange and energy balances (see the diagrams below). After each cell is solved, the outlet conditions (temperatures, flows, concentrations) become the inlet conditions for the next one. Along the way, the model also accounts for:

- Vapor losses and condensation in the distribution lines between preheaters and effects.
- Temperature losses in piping.
- The specific distribution layout of condensate across the plant.

> Mass and energy conservation are checked throughout the sequence.


## Nomenclature

The figure below shows an overall schematic of the MED plant model, with the main inputs, outputs and internal variables.

![Overall schematic of the MED model with inputs, outputs, main variables and components](./assets/med-modelling-general.png)

### Plant parameters

- Number of effects and preheaters: \(N_{ef}\), \(N\)
- Mixer distribution ratios: \(\mathbf{Y} \in \mathbb{R}^3\)
- Effect and preheater areas:
	- \(\mathbf{A}_{ef} \in \mathbb{R}^N\) [m²]
	- \(\mathbf{A}_{ph} \in \mathbb{R}^N\) [m²]
- Condenser area: \(A_c\) [m²]
- Indices for effects without/with mixer distillate: \(m\), \(m_2\)

> **Note on nomenclature**  
> In this model, flows (mass or volumetric) are denoted with a capital \(M\). This differs from the rest of the SolarMED documentation, where lowercase \(\dot{m}\) is used for mass flows and \(q\) for volumetric flows.

### Model parameters

- Overall effect heat transfer coefficients: \(\mathbf{U}_{ef} \in \mathbb{R}^N\) [kW/(m²·K)]
- Overall preheater heat transfer coefficients: \(\mathbf{U}_{ph} \in \mathbb{R}^N\) [kW/(m²·K)]
- Vapor‑loss factor in preheater–effect distribution lines due to condensation: \(\mathbf{\Delta M}_v \in \mathbb{R}^2\)

### Flows [kg/s]

- \(M_s\): heat source flow
- \(M_{cw}\): cooling water flow
- \(M_f\): feedwater flow
- \(M_{prod}\): total distillate production
- \(M_{brine}\): total brine discharge
- \(M_{v,in}\), \(M_{v,out}\): vapor into / out of an effect
- \(M_{b,in}\), \(M_{b,out}\): brine into / out of an effect
- \(M_{gb}\), \(M_{gf}\): vapor generated by boiling / flashing
- \(M_{dest}\): mixed distillate entering an effect
- \(M_{dest,f}\): fraction of \(M_{dest}\) that flashes
- \(M_{d,in}\): distillate from previous effect
- \(M_{vh}\): distillate from previous preheater
- \(M_{d,out}\): distillate leaving an effect
- \(M_{da}\), \(M_{db}\): distillate split from mixer to effect / bypass
- \(M_{mix,in}\): distillate in the distribution line entering an effect
- \(M_{mix,out}\): distillate leaving an effect to the distribution line
- \(M_{bb}\): non‑flashing brine

### Temperatures [°C]

Some temperature variables are omitted here when they follow directly from flow notation.

- \(T_{s,in}\), \(T_{s,out}\): heat source temperature in / out of the first effect
- \(T_{cw,in}\), \(T_{cw,out}\): cooling water temperature in / out of the condenser
- \(T_f\): preheated feedwater temperature
- \(T_{mix,in}\), \(T_{mix,out}\), \(T_{mixx}\): mixer inlet / outlet and post‑subcooling temperature in the effect
- \(T_{vv}\), \(T_{dd}\): preheater and previous‑effect distillate temperatures after subcooling
- \(T_{ph,in}\), \(T_{ph,out}\): preheater inlet / outlet temperatures

### Concentrations and pressures

- \(X_{b,in}\), \(X_{b,out}\), \(X_{bb}\): brine salinity in / out and non‑flashing brine [g/kg]
- \(X_f\): feedwater salinity [g/kg]
- \(P_s\): source pressure at the first effect [bar]

### Heat contributions [W]

- \(\dot{Q}_{v,ant}\): heat from previous‑effect vapor
- \(\dot{Q}_{ph,ant}\): heat from preheater distillate
- \(\dot{Q}_{ef,ant}\): heat from previous‑effect distillate
- \(\dot{Q}_{mix}\): heat from the distribution‑line mixer
- \(\dot{Q}_{\delta}\): heat from vapor condensed along the path
- \(\dot{Q}_{dest}\): total heat from distillate streams
- \(\dot{Q}_{ext,source}\): heat from the external source

### Auxiliary components and losses

**Demister**

- \(v_{vap}\): vapor velocity [m/s]
- \(h_{dem}\): demister height [m]
- \(w_{dem}\): demister thickness [m]
- \(l_{dem}\): demister length [m]
- \(\rho_{dem}\): packing density [kg/m³]
- \(D_{dem}\): wire diameter [mm]

**Piping (preheater–effect)**

- \(L_{tub}\): pipe length [m]
- \(D_{tub}\): internal pipe diameter [mm]

---

## Calibration Mode

> MATLAB Implemententation available in the [calibration folder](./calibration/calibration_model.m)

![MED model calibration mode diagram with inputs and outputs](./assets/med-modelling-calibration-interface.png)

In **calibration mode**, the model is used to infer detailed parameters and internal quantities that cannot be measured directly. Examples include:

- Per‑effect and per‑preheater heat transfer coefficients.
- Contributions of different heat transfer modes (boiling, flashing, etc.).
- Per‑effect brine concentration and distillate production.

The outputs from this mode can be used to build surrogate models (e.g. data‑driven regressions) for these parameters.

To run the model in calibration mode, an **extended set of plant measurements** is required. This typically includes temperatures and/or pressures per effect and preheater (or at least a subset of them, with the rest estimated by interpolation or other methods).

The numerical solution works as follows:

1. An initial guess for the vapor‑loss factor \(\Delta M_v\) in the distribution lines is provided.
2. For each cell (effect + preheater), the model solves a nonlinear system to obtain the overall heat transfer coefficients \(U_{ef}\) and \(U_{ph}\) and the outlet conditions.
3. At the condenser, the total distillate production predicted by the model is compared to the measured production.
4. The vapor‑loss factor \(\Delta M_v\) is adjusted.
5. Steps 2–4 are repeated until the calculated distillate matches the measured value within a specified tolerance.

Because it exposes so many internal quantities, calibration mode is well suited for:

- Detecting performance degradation (e.g. fouling).
- Tracking trends over time for predictive maintenance.
- Generating rich datasets to train data‑driven models for the simulation mode.
- Providing detailed information for O&M analysis.

**Main outputs in calibration mode**

- Identified model parameters: \(U_{ef}\), \(U_{ph}\), \(\Delta M_v\).
- Detailed per‑effect and per‑preheater results: temperatures, pressures, flows (condensate, flashed condensate, vapor from boiling/flashing, etc.), salinities, heat transfer rates, and more.
- Global plant‑level outputs: total distillate production, overall brine concentration, heat source outlet temperature, etc.

---

## Simulation Mode

> MATLAB Implemententation available in the [simulation folder](./simulation/simulation_model.m)

![MED model simulation mode diagram with inputs and outputs](./assets/med-modelling-simulation-interface.png)

In **simulation mode** the same physical structure and equations are used, but with fewer required inputs. Instead of directly identifying parameters from measurements, the model relies on **pre‑trained parameter models**, such as:

- Empirical correlations from the literature.
- Data‑driven models trained on the calibration‑mode results of a sufficiently long experimental campaign.

Concretely, the model uses external models (empirical or data‑driven) for:

- \(U_{ef}\): effect heat transfer coefficients.
- \(U_{ph}\): preheater heat transfer coefficients.
- \(\Delta M_v\): vapor‑loss factors in the distribution lines.

When solving the sequence of cells, these parameter models are queried at each step with the current operating conditions (flows, temperatures, salinities, pressures). They return the parameters needed to close the mass and energy balances for each effect and preheater. The iterative estimation of \(\Delta M_v\) used in calibration mode is therefore skipped.

Simulation mode provides a detailed, steady‑state representation of an MED plant with minimal additional assumptions and **without requiring plant outputs (like measured production) as inputs**. It is particularly useful for:

- Plant design and what‑if studies.
- Real‑time or faster‑than‑real‑time performance prediction.
- Integration into larger plant models or optimization frameworks.

---

## Model Implementation and Cell Structure

The MED plant is decomposed into **cells**, each containing one effect (evaporator) and one preheater. The following diagrams summarize the internal structure and governing equations for each part.

### Cell overview

![Detailed schematic of a single cell in the MED model containing the effect (left) and the preheater (right)](./assets/med-modelling-cell.png)

Each cell receives as inputs:

- Heat source flow and temperature from the previous cell (or from the external source for the first effect).
- Feedwater and distillate flows/temperatures.
- Brine from the previous effect.

It outputs updated brine, distillate and vapor streams, along with updated temperatures, which are then passed to the next cell.

### Effect (evaporator)

![Detailed schematic of a single cell in the MED model with the effect equations](./assets/med-modelling-effect.png)

![Detailed schematic of a single cell in the MED model with the energy source side equations and internal effect condensate flashing](./assets/med-modelling-effect2.png)

In each effect, the model:

- Balances mass for brine, vapor and distillate.
- Accounts for vapor generated by boiling and by flashing.
- Tracks the flashing of internal condensate and the associated heat release.
- Couples the energy source side (e.g. hot water or steam) to the evaporation process through an overall heat transfer coefficient.

The equations ensure that the heat transferred from the source side equals the enthalpy change of the evaporating/condensing streams, under the assumed operating pressure and temperature.

### Preheater

![Detailed schematic of a single cell in the MED model with the preheater equations](./assets/med-modelling-preheater.png)

The preheater warms the incoming feedwater using the condensation heat from vapor and/or distillate streams. The model enforces:

- Mass conservation for the involved streams.
- Energy balance between hot and cold sides using the overall preheater heat transfer coefficient \(U_{ph}\).

The outlet feed temperature then becomes the inlet for the next effect.

### Distribution lines and auxiliaries

![Detailed schematic of a single cell in the MED model including distribution lines for the energy source side and generated steam, plus auxiliary elements like the demister and preheater–effect distribution line geometry](./assets/med-modelling-distribution.png)

The distribution network for the heat source and generated steam is explicitly represented. The model includes:

- Vapor losses and condensation along the distribution lines.
- Mixing and splitting of distillate streams.
- Auxiliary elements such as the demister and the geometry of the preheater–effect piping.

These elements contribute to additional heat and mass transfer terms (e.g. \(\dot{Q}_{mix}\), \(\dot{Q}_{\delta}\)) that are accounted for in each cell’s balances.

---

## Validation

The model has been validated using the same experimental dataset described in the main SolarMED documentation. The procedure is:

1. Run the **calibration mode** of the model on the dataset.  
	 This yields time series of identified parameters (\(U_{ef}\), \(U_{ph}\), \(\Delta M_v\)) and detailed internal variables.
2. Split the resulting data into a **training set** and a **validation set**.
3. Use the training set to build data‑driven models for the parameters needed in **simulation mode**.
4. Run **simulation mode** on the validation set using only the reduced input set and the learned parameter models.

The figures below illustrate the validation results.

![Heat transfer coefficients comparison between calibration mode and simulation mode for the validation set](./assets/med-fp-model-heat-transfer-coeff-comp.png)

The comparison of heat transfer coefficients estimated in calibration mode versus those used in simulation mode shows overall good agreement. As expected, the calibration model generally fits better because it leverages more detailed measurements, while the simulation model relies on parameter models with fewer inputs.

Larger discrepancies are observed for some points in the latter effects (e.g. effects 11–14). This is likely due to the sequential nature and strong non‑linear coupling of the plant: small deviations in earlier effects can accumulate and lead to larger errors downstream. Nevertheless, both modes capture the main trends and provide consistent behavior across the effects.

The next figure summarizes the overall validation of both modes with respect to plant‑level quantities such as total distillate production.

![MED first‑principles model validation: calibration mode (top) and simulation mode (bottom)](./assets/med-fp-model-calibration-mode-validation.png)

![MED first‑principles model validation: calibration mode (top) and simulation mode (bottom)](./assets/med-fp-model-simulation-mode-validation.png)

The results show that both model variants can accurately predict key outputs, such as plant distillate production, over the validation dataset. The calibration model provides the highest accuracy at the cost of requiring richer measurements, while the simulation model offers a practical trade‑off between input requirements and predictive performance.

